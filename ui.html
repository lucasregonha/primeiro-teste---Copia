<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />


  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    & h4 {
      font-weight: 600;
      font-size: 14px;
      margin: 0;
      display: inline-block;
      line-height: 14px;
    }



    html,
    body {
      display: flex;
      flex-direction: column;
      gap: 12px;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #F4F4F5;
    }

    body {
      font-family: "Inter";
      padding: 12px;
      margin: 0;
      font-size: 14px;
      font-weight: 500;
    }

    .h3 {
      font-weight: normal;
      font-size: 14px;
      margin: 0;
      display: inline-block;
      line-height: 14px;
    }

    .tabs {
      display: flex;
      gap: 4px;
      border-bottom: 1px solid #E4E4E7;
      width: fit-content;
    }

    .tab {
      font-size: 14px;
      color: #18181B;
      font-weight: 500;
      padding: 8px 16px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      font-weight: 500;
    }

    .tab.active {
      color: #4361EE;
      border-bottom-color: #4361EE;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .group {
      display: flex;
      align-items: center;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 6px;
      cursor: pointer;
    }

    .group-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .group-right {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .swatch {
      width: 26px;
      height: 26px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    .type-label {
      font-size: 9px;
      color: #555;
      line-height: 1;
    }

    .detail {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }

    .detail-swatch {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      border: 1px solid #ddd;
    }

    .text-preview {
      border: 1px solid #ddd;
      border-radius: 8px;
      background: white;
      text-align: center;
      width: 64px;
      height: 64px;
      box-sizing: border-box;
      text-align: center;
      bottom: auto;
      top: auto;
    }

    .text-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 11px;
      color: #555;
      text-align: center;
    }

    #hex-code {
      font-size: 12px;
      color: #333;
    }

    .nav {
      display: flex;
      gap: 8px;
    }

    button {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      cursor: pointer;
    }

    .back {
      margin-top: 20px;
      font-size: 11px;
      cursor: pointer;
      text-decoration: underline;
    }

    .select-all {
      margin-top: 10px;
      background-color: #F4F4F5;
      color: #4361EE;
    }

    .empty {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 346px;
      text-align: center;
      color: #777;
    }

    .empty-2 {
      border: 2px solid #E4E4E7;
      border-radius: 8px;
      display: flex;
      gap: 8px;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 287px;
      text-align: center;
      color: #777;
    }

    .switch-container {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: sans-serif;
      font-size: 14px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 32px;
      height: 16px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(38, 39, 43, 0.08);
      transition: 0.4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 12px;
      width: 12px;
      left: 2px;
      bottom: 2.2px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: #4361EE;
      /* cor do switch ligado */
    }

    input:checked+.slider:before {
      transform: translateX(16px);
    }

    .app-wrapper {
      display: flex;
      flex-direction: column;
      gap: 8px;

      & img {
        width: 40px;
        height: 40px;
      }
    }

    .group {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 4px;
      /* padding em volta de tudo */
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }

    .group:hover {
      background: rgba(112, 112, 123, 0.16);
    }

    .group::after {
      content: "Ver mais";
      position: absolute;
      right: 8px;
      bottom: 10px;
      transform: translateY(-50%);
      font-size: 12px;
      font-weight: 500;
      color: rgba(24, 24, 27, 0.72);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .group:hover::after {
      opacity: 1;
    }

    .swatch-large {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      border: 1px solid #ddd;
      flex-shrink: 0;
    }

    .group-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .group-info-top {
      display: flex;
      align-items: center;
      gap: 8px;
      /* espa√ßo entre HEX e tipo */
    }

    .group-info-bottom {
      font-size: 12px;
      color: rgba(24, 24, 27, 0.72);
    }

    .app-wrapper-2 {
      border: 2px solid #E4E4E7;
      /* borda ao redor da caixa */
      border-radius: 8px;
      height: 287px;
      /* altura fixa */
      overflow-y: auto;
      /* scroll vertical quando passar do tamanho */
      padding: 12px;
      /* padding interno da caixa */
      display: flex;
      flex-direction: column;
      gap: 8px;
      /* espa√ßo entre os itens */

    }

    h4+.app-wrapper-2 {
      margin-top: 8px;
    }


    .group-info-top .hex {
      font-size: 12px;
      color: #18181B;
    }

    .group-info-top .type-label {
      font-size: 12px;
      color: rgba(24, 24, 27, 0.72);
    }

    /* Loading Spinner */
    .spinner-container {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 16px;
      position: fixed;
      top: 62px;
      left: 12px;
      right: 12px;
      bottom: 12px;
      background-color: #F4F4F5;
      z-index: 100;
      pointer-events: none;
    }

    .spinner-container.show {
      display: flex;
      pointer-events: auto;
    }

    .spinner {
      width: 36px;
      height: 36px;
      border: 3px solid #e0e0e0;
      border-top: 3px solid #4361EE;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      box-sizing: border-box;
    }

    .spinner-text {
      font-size: 13px;
      color: #666;
      font-family: "Inter", sans-serif;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    /* NEW STYLES FOR COLOR DETAIL */
    .detail-color-wrapper {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 12px;
    }

    .detail-color-container {
      display: flex;
      gap: 8px;
      flex: 1;
      overflow: hidden;
    }

    .detail-left {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
      width: 120px;
    }

    .detail-swatch-large {
      width: 64px;
      height: 64px;
      border-radius: 16px;
      border: 2px solid #E4E4E7;
    }

    .detail-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
    }

    .detail-label {
      font-size: 12px;
      font-weight: 500;
      color: #18181B;
      align-self: flex-start;
    }

    .detail-info #hex-code {
      font-size: 14px;
      font-weight: 600;
      color: #18181B;
      width: 120px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: center;
    }

    .detail-info .type-label {
      font-size: 12px;
      color: rgba(24, 24, 27, 0.6);
    }

    .detail-nav {
      display: flex;
      align-items: center;
      width: 100%;
      justify-content: space-between;
    }



    .nav-counter {
      font-size: 12px;
      color: rgba(24, 24, 27, 0.6);
      width: 60px;
      text-align: center;
      white-space: nowrap;
    }

    .detail-right {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
    }

    .detail-right h4 {
      font-size: 14px;
      font-weight: 600;
      color: #18181B;
      margin: 0;
      margin-bottom: 4px;
    }

    .tokens-container {
      border: 1px solid #E4E4E7;
      border-radius: 8px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
      height: 273px;
    }

    .tokens-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      overflow-y: auto;
    }

    .token-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 4px;
      border-radius: 6px;
      background: rgba(38, 39, 43, 0.08);
      height: 28px;
      cursor: pointer;
      transition: all 0.2s;
      justify-content: flex-start;
      user-select: none;
    }

    .token-item:hover {
      background: rgba(24, 24, 27, 0.12);
    }

    .token-item.applying {
      opacity: 0.6;
      pointer-events: none;
    }

    .token-swatch {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 1px solid #E4E4E7;
      flex-shrink: 0;
    }

    .token-name {
      font-size: 12px;
      color: #18181B;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }

    .token-info-small {
      font-size: 10px;
      color: rgba(24, 24, 27, 0.6);
    }

    .token-check-icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      color: #2D41E3;
    }

    .detail-footer {
      display: flex;
      justify-content: center;
      align-items: center;
      padding-top: 8px;
      align-items: center;
    }

    .detail-footer .select-all {
      margin: 0;
      /* padding: 6px 12px; */
      font-size: 12px;
      /* border: 1px solid #E4E4E7; */
      /* border-radius: 6px; */
      /* background: white; */
      cursor: pointer;
      transition: all 0.2s;
    }

    .detail-footer .select-all:hover {
      background: #F4F4F5;
      border-color: #BFBFBF;
    }

    .detail-footer .back {
      width: 100%;
      align-items: center;
      justify-content: center;
      margin: 0;
      font-size: 12px;
      color: #4361EE;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
    }

    .detail-footer .back:hover {
      color: #2D41E3;
      text-decoration: underline;
    }

    .container {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 12px;
    }

    .empty-state-tokens {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      padding: 12px;
      text-align: center;
      color: rgba(24, 24, 27, 0.6);
      font-size: 12px;
    }


    .nav-icon {
      width: 20px;
      height: 20px;
      stroke: currentColor;
      flex-shrink: 0;
    }

    .detail-nav button {
      width: 32px;
      height: 32px;
      padding: 0;
      border: none;
      border-radius: 6px;
      background: transparent;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(24, 24, 27, 0.72);
    }

    .detail-nav button:hover:not(:disabled) {
      background: rgba(112, 112, 123, 0.16);
    }

    .detail-nav button:disabled {
      opacity: 0.33;
      cursor: default;
    }

    .back-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      color: #4361EE;
      background: transparent;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      margin: 0;
    }

    .back-button:hover {
      color: #2D41E3;
      background: rgba(112, 112, 123, 0.16);
    }

    .back-button svg {
      width: 16px;
      height: 16px;
    }

    .select-all-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #18181B;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
      width: 100%;
    }

    .select-all-checkbox:hover {
      background: #F4F4F5;
      border-color: #BFBFBF;
    }

    .select-all-checkbox input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: #4361EE;
    }

    /* Loading inline para tokens */
    .tokens-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      gap: 12px;
    }

    .tokens-loading .spinner {
      width: 24px;
      height: 24px;
      border-width: 2px;
    }

    .tokens-loading .spinner-text {
      font-size: 11px;
    }
  </style>
</head>

<body>
  <div class="tabs">
    <div class="tab active" onclick="switchTab('colors')">Colors</div>
    <div class="tab" onclick="switchTab('typography')">Font styles</div>
  </div>

  <div id="app"></div>
  <div id="top-bar-container"></div>

  <div class="spinner-container" id="spinner">
    <div class="spinner"></div>
    <div class="spinner-text">Carregando</div>
  </div>

  <script>

    // ui.ts
    const splash = document.createElement('div');
    splash.style.position = 'fixed';
    splash.style.top = '0';
    splash.style.left = '0';
    splash.style.width = '100vw';
    splash.style.height = '100vh';
    splash.style.background = '#2D41E3';
    splash.style.display = 'flex';
    splash.style.alignItems = 'center';
    splash.style.justifyContent = 'center';
    splash.style.zIndex = '9999';

    // Adiciona o SVG
    splash.innerHTML = `<svg width="114" height="45" viewBox="0 0 114 45" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_191_8225)">
<path d="M36.1751 0V6.84588H27.0871C23.9607 6.84588 21.4254 9.32588 21.4254 12.3842V19.0306H14.4271V2.11592C14.4282 0.947679 15.397 0 16.5901 0H21.4254V3.23245C23.1062 1.25689 25.6383 0 28.4702 0H36.1751Z" fill="white"/>
<path d="M11.5272 0.0379969H9.36418V1.38564C8.37166 0.544552 7.07707 0.0379969 5.66273 0.0379969C5.20207 0.0379969 4.75436 0.0918183 4.32606 0.194185C2.27198 0.678577 0.655896 2.25945 0.159636 4.26773C0.0549896 4.68669 -3.05176e-05 5.12465 -3.05176e-05 5.57527V13.4923C-3.05176e-05 13.9419 0.0549896 14.3798 0.158557 14.7988C0.654817 16.8071 2.27198 18.3879 4.32606 18.8744C4.75436 18.9768 5.20207 19.0306 5.66273 19.0306C7.07815 19.0306 8.37166 18.523 9.36418 17.683V19.0306H13.6892V2.15286C13.6892 0.983565 12.7215 0.0369415 11.5261 0.0369415L11.5272 0.0379969ZM9.36418 13.4923C9.36418 14.2036 8.78485 14.7819 8.06204 14.7988C8.05017 14.7988 6.48803 14.7988 6.48803 14.7988C5.29377 14.7988 4.32498 13.8522 4.32498 12.6829V6.38259C4.32498 5.21435 5.29377 4.26667 6.48803 4.26667H8.02751C8.76543 4.26667 9.36418 4.85238 9.36418 5.57422V13.4912V13.4923Z" fill="white"/>
<path d="M56.6265 5.53833V19.0306H49.6281V8.9618C49.6281 7.79355 48.6593 6.84588 47.4651 6.84588H46.0745C45.8695 6.84588 45.6699 6.87331 45.4822 6.92608C44.7119 7.14031 44.1175 7.76084 43.9557 8.53439C43.9276 8.67158 43.9114 8.81511 43.9114 8.96074V19.0296H36.9131V0H43.9114V2.61087C43.9114 2.61087 43.9093 2.61403 43.9082 2.61614H43.9114V2.61087C44.9115 1.04266 46.6905 0 48.7176 0H50.9648C52.9941 0 54.7752 1.04582 55.7742 2.61509C56.3147 3.46357 56.6265 4.46401 56.6265 5.53728V5.53833Z" fill="white"/>
<path d="M113.937 0.0189972V16.8957C113.937 18.064 112.969 19.0116 111.774 19.0116H106.939V16.4008C106.939 16.4008 106.941 16.3976 106.942 16.3955H106.939V16.4008C105.939 17.969 104.16 19.0116 102.132 19.0116H99.8852C97.856 19.0116 96.0748 17.9658 95.0758 16.3965C94.5353 15.5481 94.2236 14.5476 94.2236 13.4744V0.0189972H101.222V10.0498C101.222 11.2181 102.191 12.1658 103.385 12.1658H104.776C104.981 12.1658 105.18 12.1383 105.368 12.0856C106.138 11.8713 106.733 11.2508 106.894 10.4772C106.922 10.34 106.939 10.1965 106.939 10.0509V0.0189972H113.937Z" fill="white"/>
<path d="M93.4986 8.69164C93.4986 8.66315 93.4964 8.63571 93.4953 8.60827C93.4921 8.53229 93.4878 8.45841 93.4824 8.38349C93.4802 8.36027 93.4792 8.33811 93.4781 8.31489C93.4705 8.22202 93.4619 8.12915 93.4522 8.03628C93.45 8.01307 93.4468 7.98985 93.4436 7.96558C93.4349 7.89276 93.4274 7.821 93.4166 7.74818C93.4123 7.72074 93.409 7.69436 93.4047 7.66692C93.3896 7.57511 93.3756 7.4833 93.3583 7.39148C93.3583 7.38726 93.3583 7.38199 93.3562 7.37776C93.34 7.29017 93.3217 7.20258 93.3033 7.11499C93.2979 7.09072 93.2915 7.06539 93.2871 7.04006C93.2699 6.96408 93.2515 6.88809 93.2332 6.81211C93.2289 6.79628 93.2246 6.78045 93.2202 6.76462C93.1965 6.67386 93.1717 6.58311 93.1447 6.49235C93.1393 6.47652 93.135 6.46174 93.1296 6.44591C93.107 6.36888 93.0822 6.29078 93.0563 6.2148C93.0498 6.19791 93.0444 6.17997 93.039 6.16309C92.9775 5.97946 92.9095 5.80006 92.8362 5.62276C92.8308 5.61115 92.8254 5.59955 92.8211 5.58794C92.3691 4.50834 91.7099 3.53639 90.89 2.71641C90.89 2.71641 90.8878 2.7143 90.8867 2.71218C90.6893 2.51589 90.4833 2.32805 90.2686 2.14864C90.2632 2.14442 90.2578 2.1402 90.2535 2.13598C90.1855 2.07899 90.1165 2.02411 90.0474 1.96818C90.0442 1.96818 90.042 1.96502 90.0399 1.96291C89.8942 1.84999 89.7443 1.74023 89.5922 1.63576C89.5846 1.63048 89.576 1.6252 89.5684 1.61993C89.5015 1.57455 89.4336 1.52917 89.3656 1.48484C89.3548 1.47746 89.3451 1.47113 89.3343 1.46479C89.1811 1.36665 89.0247 1.27378 88.865 1.18408C88.8553 1.17986 88.8478 1.17458 88.8391 1.1693C88.7701 1.13131 88.7 1.09438 88.6309 1.05849C88.6147 1.05005 88.5986 1.04161 88.5824 1.03317C88.5122 0.997286 88.441 0.961405 88.3698 0.927635C88.3601 0.922358 88.3515 0.918137 88.3429 0.913915C88.2598 0.873813 88.1757 0.836877 88.0915 0.798885C88.085 0.795719 88.0786 0.793609 88.0721 0.790443C87.9976 0.757728 87.9243 0.727123 87.8488 0.696519C87.8283 0.688076 87.8078 0.680689 87.7873 0.672247C87.7215 0.645864 87.6557 0.620536 87.5888 0.596263C87.5704 0.588876 87.551 0.581489 87.5327 0.576212C87.3644 0.515004 87.195 0.459071 87.0224 0.407361C87.0008 0.401029 86.9771 0.394697 86.9555 0.388365C86.8897 0.370424 86.825 0.351429 86.7592 0.334543C86.7343 0.327156 86.7106 0.320824 86.6847 0.315548C86.6092 0.296552 86.5348 0.276501 86.4582 0.259616C86.4463 0.257505 86.4355 0.254339 86.4226 0.251173C86.3352 0.231122 86.2478 0.212126 86.1583 0.195241C86.1367 0.19102 86.1129 0.186798 86.0914 0.182577C86.0245 0.169913 85.9565 0.158305 85.8885 0.146696C85.8616 0.14142 85.8335 0.137198 85.8055 0.131922C85.7375 0.121368 85.6695 0.11187 85.6016 0.102373C85.58 0.0992066 85.5563 0.0960406 85.5336 0.0928747C85.4441 0.0812661 85.3534 0.0717682 85.2628 0.0622703C85.2466 0.0601597 85.2283 0.0591044 85.2121 0.058049C85.1377 0.0506618 85.0643 0.0443299 84.9899 0.0401086C84.9597 0.0379979 84.9305 0.0369426 84.9014 0.034832C84.8356 0.0306107 84.7687 0.0274447 84.7018 0.0242787C84.6749 0.0242787 84.6468 0.0221681 84.6188 0.0211128C84.5271 0.0190021 84.4343 0.0168915 84.3415 0.0168915H59.508C58.3138 0.0168915 57.345 0.964571 57.345 2.13281V16.8947C57.345 18.0629 58.3138 19.0106 59.508 19.0106H84.3415C84.4343 19.0106 84.5271 19.0085 84.6188 19.0064C84.6468 19.0064 84.6749 19.0042 84.7029 19.0032C84.7687 19 84.8356 18.9969 84.9014 18.9926C84.9305 18.9905 84.9608 18.9895 84.9899 18.9874C85.0632 18.9821 85.1355 18.9758 85.2078 18.9705C85.2261 18.9684 85.2456 18.9673 85.2639 18.9652C85.3535 18.9557 85.443 18.9462 85.5315 18.9346C85.5563 18.9314 85.5811 18.9272 85.6081 18.924C85.6728 18.9145 85.7375 18.9061 85.8022 18.8956C85.8335 18.8913 85.8637 18.8861 85.8939 18.8808C85.9576 18.8692 86.0202 18.8586 86.0838 18.847C86.1097 18.8417 86.1356 18.8365 86.1615 18.8312C86.2478 18.8143 86.333 18.7963 86.4182 18.7774C86.4377 18.7731 86.4582 18.7679 86.4776 18.7626C86.5445 18.7467 86.6114 18.7309 86.6772 18.714C86.7085 18.7066 86.7387 18.6982 86.7689 18.6898C86.826 18.6739 86.8832 18.6592 86.9404 18.6433C86.9706 18.6338 86.9997 18.6264 87.0299 18.6169C87.1022 18.5958 87.1723 18.5726 87.2446 18.5494C87.2597 18.5452 87.2738 18.5399 87.2899 18.5346C87.3676 18.5093 87.4453 18.4819 87.523 18.4544C87.551 18.4439 87.5801 18.4333 87.6082 18.4228C87.6621 18.4027 87.7172 18.3806 87.7711 18.3594C87.8013 18.3478 87.8304 18.3362 87.8606 18.3236C87.9189 18.3003 87.9761 18.2761 88.0322 18.2507C88.0548 18.2402 88.0786 18.2318 88.1012 18.2212C88.1789 18.1874 88.2544 18.1526 88.331 18.1167C88.3547 18.1041 88.3785 18.0935 88.4033 18.0808C88.4572 18.0545 88.5123 18.0281 88.5651 18.0006C88.5942 17.9859 88.6223 17.9721 88.6503 17.9574C88.7021 17.9299 88.755 17.9014 88.8068 17.8729C88.8305 17.8592 88.8553 17.8476 88.8801 17.8328C88.9535 17.7917 89.0258 17.7505 89.0991 17.7073C89.1142 17.6978 89.1272 17.6904 89.1423 17.6809C89.2016 17.645 89.261 17.6081 89.3203 17.5711C89.344 17.5553 89.3667 17.5405 89.3915 17.5257C89.4422 17.493 89.494 17.4593 89.5447 17.4244C89.5663 17.4086 89.5889 17.3949 89.6105 17.3791C89.6774 17.3337 89.7443 17.2862 89.8101 17.2387C89.8133 17.2355 89.8166 17.2334 89.8198 17.2313C89.891 17.1807 89.96 17.1268 90.0291 17.073C90.0453 17.0603 90.0614 17.0487 90.0765 17.035C90.1305 16.9928 90.1844 16.9506 90.2362 16.9063C90.2535 16.8925 90.2707 16.8788 90.2869 16.8641C90.3473 16.8145 90.4067 16.7627 90.4649 16.7121C90.4714 16.7058 90.4779 16.7005 90.4822 16.6963C90.5512 16.6361 90.6181 16.5749 90.685 16.5126C90.6893 16.5084 90.6936 16.5042 90.698 16.5C90.7584 16.443 90.8177 16.386 90.876 16.3269C90.8867 16.3163 90.8965 16.3068 90.9062 16.2973C90.9644 16.2382 91.0227 16.1781 91.0788 16.1179C91.0831 16.1148 91.0863 16.1106 91.0896 16.1074C91.2169 15.9713 91.3399 15.833 91.4585 15.6905C91.4585 15.6884 91.4607 15.6863 91.4628 15.6842C92.0217 15.0099 92.4812 14.2542 92.8232 13.4395C92.8276 13.4279 92.8329 13.4174 92.8373 13.4047C92.9117 13.2274 92.9786 13.047 93.0412 12.8633C93.0466 12.8475 93.052 12.8306 93.0573 12.8148C93.0832 12.7367 93.1081 12.6575 93.1329 12.5784C93.1372 12.5636 93.1415 12.5499 93.1458 12.5351C93.1728 12.4444 93.1987 12.3526 93.2235 12.2597C93.2267 12.2449 93.23 12.2312 93.2343 12.2175C93.2537 12.1394 93.2731 12.0613 93.2904 11.9832C93.2958 11.96 93.3012 11.9378 93.3055 11.9135C93.3249 11.8217 93.3454 11.7299 93.3616 11.637C93.3778 11.5442 93.3939 11.4503 93.408 11.3563C93.4123 11.3321 93.4155 11.3067 93.4187 11.2803C93.4306 11.2054 93.4392 11.1294 93.4479 11.0535C93.45 11.0334 93.4533 11.0112 93.4554 10.9901C93.4662 10.8973 93.4738 10.8023 93.4813 10.7084C93.4813 10.6883 93.4835 10.6661 93.4856 10.6461C93.491 10.5701 93.4953 10.492 93.4986 10.416C93.4986 10.3886 93.5007 10.3622 93.5018 10.3358C93.5051 10.2398 93.5072 10.1427 93.5072 10.0456V8.97236C93.5072 8.87632 93.5051 8.78134 93.5018 8.68636L93.4986 8.69164ZM75.151 9.78812C75.151 9.7438 75.151 9.70053 75.1488 9.65726C75.1488 9.72375 75.1445 9.79023 75.1391 9.85566C75.1359 9.92215 75.1305 9.98863 75.1229 10.0541C75.1165 10.1195 75.1089 10.1828 75.1003 10.2472C75.1003 10.2514 75.1003 10.2567 75.0981 10.262C75.0927 10.3094 75.0852 10.3569 75.0776 10.4034C75.0744 10.4255 75.0701 10.4488 75.0658 10.4709C75.0658 10.4794 75.0636 10.4867 75.0615 10.4952C75.0528 10.5416 75.0442 10.5881 75.0345 10.6334C75.0205 10.6968 75.0075 10.7601 74.9902 10.8223C74.9751 10.8825 74.96 10.9426 74.9439 11.0028C74.9406 11.0123 74.9385 11.0207 74.9352 11.0313C74.9201 11.0851 74.9029 11.1389 74.8856 11.1928C74.8662 11.254 74.8457 11.3141 74.823 11.3732C74.8068 11.4207 74.7885 11.4682 74.7691 11.5146C74.7162 11.6518 74.6569 11.7848 74.5932 11.9156C74.5684 11.9663 74.5425 12.017 74.5156 12.0666C74.4573 12.1774 74.3937 12.2871 74.3268 12.3937C74.2944 12.4465 74.2599 12.5003 74.2243 12.552C74.193 12.5984 74.1617 12.6449 74.1283 12.6892C74.0873 12.7462 74.0463 12.8021 74.002 12.8581C73.9643 12.9066 73.9254 12.9562 73.8866 13.0026C73.8866 13.0026 73.8866 13.0026 73.8844 13.0047C73.8456 13.0522 73.8057 13.0997 73.7625 13.1462C73.7215 13.1926 73.6795 13.2401 73.6352 13.2844C73.5921 13.3298 73.5489 13.3752 73.5025 13.4195C73.4572 13.4638 73.4119 13.5071 73.3655 13.5493C73.2771 13.6316 73.1854 13.7118 73.0904 13.7867C73.085 13.791 73.0807 13.7952 73.0753 13.7983C72.7808 14.0347 72.4626 14.2416 72.1227 14.4168C72.058 14.4516 71.9922 14.4832 71.9253 14.5149C71.7948 14.5867 71.6556 14.6458 71.51 14.688C71.51 14.688 71.5078 14.688 71.5067 14.688C70.8799 14.9223 70.1992 15.051 69.4882 15.051H63.0088C62.2709 15.051 61.6721 14.4653 61.6721 13.7435V5.284C61.6721 4.56216 62.2709 3.97646 63.0088 3.97646H69.4882C70.1992 3.97646 70.8799 4.10521 71.5067 4.33949C71.5067 4.33949 71.5089 4.33949 71.51 4.33949C71.6545 4.38276 71.7948 4.44186 71.9253 4.51256C71.9922 4.54422 72.058 4.57588 72.1227 4.61071C72.4065 4.75529 72.6762 4.9252 72.9286 5.1141C72.9782 5.15103 73.0279 5.18903 73.0753 5.22702C73.0807 5.23124 73.085 5.23546 73.0904 5.23968C73.1854 5.31566 73.2771 5.39481 73.3655 5.47713C73.4119 5.51934 73.4572 5.56261 73.5025 5.60693C73.5489 5.65126 73.5921 5.69558 73.6352 5.74201C73.6795 5.78739 73.7215 5.83383 73.7625 5.88026C73.8057 5.9267 73.8456 5.97419 73.8844 6.02168C73.8844 6.02168 73.8866 6.02168 73.8866 6.02379C73.9265 6.07022 73.9643 6.11982 74.002 6.16836C74.0387 6.21374 74.0732 6.26018 74.1067 6.30556C74.1239 6.32983 74.1412 6.35305 74.1574 6.37837C74.1833 6.41425 74.207 6.45014 74.2329 6.48602C74.2642 6.53351 74.2966 6.58311 74.3268 6.63165C74.3289 6.63482 74.33 6.63693 74.3322 6.64009C74.3635 6.69075 74.3947 6.74246 74.4239 6.79417C74.4541 6.84588 74.4832 6.8997 74.5112 6.95247C74.563 7.0485 74.6116 7.14665 74.6558 7.24479C74.672 7.27751 74.686 7.31128 74.7011 7.34399C74.7249 7.39887 74.7486 7.4548 74.7702 7.51179C74.7896 7.55822 74.8079 7.60571 74.8241 7.6532C74.8468 7.7123 74.8673 7.77245 74.8867 7.83366C74.9039 7.88643 74.9212 7.94025 74.9363 7.99513C74.9385 8.00357 74.9417 8.01096 74.9439 8.0194C74.96 8.08061 74.9773 8.14182 74.9913 8.20303C75.0075 8.26529 75.0215 8.32861 75.0356 8.39193C75.0474 8.44575 75.0571 8.49957 75.0668 8.5555C75.0712 8.57766 75.0744 8.59983 75.0776 8.62093C75.0873 8.66948 75.0938 8.72013 75.1003 8.76973C75.1003 8.7729 75.1003 8.77607 75.1003 8.77923C75.11 8.84255 75.1165 8.90798 75.1229 8.97236C75.1305 9.03779 75.1359 9.10427 75.1391 9.17076C75.1445 9.23724 75.1478 9.30373 75.1488 9.36916C75.151 9.32589 75.151 9.28262 75.151 9.2383V9.78495V9.78812Z" fill="white"/>
<path d="M34.0132 7.93074H31.8501V9.27839C30.8576 8.43835 29.563 7.93074 28.1487 7.93074C27.688 7.93074 27.2403 7.98456 26.812 8.08693C24.759 8.57132 23.1429 10.1522 22.6456 12.1615C22.541 12.5805 22.4859 13.0184 22.4859 13.4691V13.4923C22.4859 13.9419 22.541 14.3798 22.6445 14.7988C23.1408 16.8071 24.7579 18.3879 26.812 18.8744C27.2403 18.9768 27.688 19.0306 28.1487 19.0306C29.5641 19.0306 30.8576 18.523 31.8501 17.683V19.0306H36.1752V10.0467C36.1752 8.87736 35.2074 7.93074 34.0121 7.93074H34.0132ZM31.8501 14.2986C31.8501 15.0098 31.2708 15.5882 30.548 15.605C30.5361 15.605 28.974 15.605 28.974 15.605C27.7797 15.605 26.8109 14.6584 26.8109 13.4891V13.4838C26.8109 13.4838 26.8109 13.4817 26.8109 13.4807C26.8109 13.4796 26.8109 13.4786 26.8109 13.4775V13.4722C26.8109 12.304 27.7797 11.3563 28.974 11.3563H30.5135C31.2514 11.3563 31.8501 11.942 31.8501 12.6639V14.2975V14.2986Z" fill="white"/>
</g>
<path d="M14.4839 27.264V31.008H9.97192V44.184H5.26792V31.008H0.803925V27.264H14.4839Z" fill="white"/>
<path d="M24.3363 44.352C22.7523 44.352 21.2963 43.984 19.9683 43.248C18.6403 42.496 17.5843 41.464 16.8003 40.152C16.0323 38.824 15.6483 37.328 15.6483 35.664C15.6483 34 16.0323 32.512 16.8003 31.2C17.5843 29.872 18.6403 28.84 19.9683 28.104C21.2963 27.368 22.7523 27 24.3363 27C25.9363 27 27.3923 27.368 28.7043 28.104C30.0323 28.84 31.0803 29.872 31.8483 31.2C32.6163 32.512 33.0003 34 33.0003 35.664C33.0003 37.328 32.6163 38.824 31.8483 40.152C31.0803 41.464 30.0323 42.496 28.7043 43.248C27.3763 43.984 25.9203 44.352 24.3363 44.352ZM24.3363 39.984C25.5363 39.984 26.4803 39.592 27.1683 38.808C27.8723 38.024 28.2243 36.976 28.2243 35.664C28.2243 34.32 27.8723 33.264 27.1683 32.496C26.4803 31.712 25.5363 31.32 24.3363 31.32C23.1203 31.32 22.1683 31.712 21.4803 32.496C20.7923 33.264 20.4483 34.32 20.4483 35.664C20.4483 36.992 20.7923 38.048 21.4803 38.832C22.1683 39.6 23.1203 39.984 24.3363 39.984Z" fill="white"/>
<path d="M57.5949 28.104C56.2829 27.368 54.8269 27 53.2269 27V31.32C54.4269 31.32 55.3709 31.712 56.0589 32.496C56.7629 33.264 57.1149 34.32 57.1149 35.664C57.1149 36.976 56.7629 38.024 56.0589 38.808C55.3709 39.592 54.4269 39.984 53.2269 39.984V44.352C54.8109 44.352 56.2669 43.984 57.5949 43.248C58.9229 42.496 59.9709 41.464 60.7389 40.152C61.5069 38.824 61.8909 37.328 61.8909 35.664C61.8909 34 61.5069 32.512 60.7389 31.2C59.9709 29.872 58.9229 28.84 57.5949 28.104Z" fill="white"/>
<path d="M43.2269 27C41.6429 27 40.1869 27.368 38.8589 28.104C37.5309 28.84 36.4749 29.872 35.6909 31.2C34.9229 32.512 34.5389 34 34.5389 35.664C34.5389 37.328 34.9229 38.824 35.6909 40.152C36.4749 41.464 37.5309 42.496 38.8589 43.248C40.1869 43.984 41.6429 44.352 43.2269 44.352L43.2269 39.984C42.0109 39.984 41.0589 39.6 40.3709 38.832C39.6829 38.048 39.3389 36.992 39.3389 35.664C39.3389 34.32 39.6829 33.264 40.3709 32.496C41.0589 31.712 42.0109 31.32 43.2269 31.32L43.2269 27Z" fill="white"/>
<path d="M53.2269 39.984V44.352H43.2269L43.2269 39.984H53.2269Z" fill="white"/>
<path d="M53.2269 27V31.32H43.2269L43.2269 27H53.2269Z" fill="white"/>
<path d="M68.7096 40.584H73.9656V44.184H64.0056V27.264H68.7096V40.584Z" fill="white"/>
<path d="M85.8026 44.184L80.4986 36.768V44.184H75.7946V27.264H80.4986V34.56L85.7546 27.264H91.1786L84.9626 35.472L91.4906 44.184H85.8026Z" fill="white"/>
<path d="M97.9127 27.264V44.184H93.2087V27.264H97.9127Z" fill="white"/>
<path d="M113.335 27.264V31.008H108.823V44.184H104.119V31.008H99.6555V27.264H113.335Z" fill="white"/>
<defs>
<clipPath id="clip0_191_8225">
<rect width="114" height="19" fill="white"/>
</clipPath>
</defs>
</svg>
`;

    // Adiciona ao body da UI
    document.body.appendChild(splash);

    // Remove o splash ap√≥s 1.5s
    setTimeout(() => {
      splash.remove();
    }, 1500);



    const app = document.getElementById("app");
    const topBarContainer = document.getElementById("top-bar-container");
    const spinner = document.getElementById("spinner");

    let viewMode = "list";
    let currentGroup = null;
    let currentIndex = 0;
    let showHidden = false;
    let currentTab = "colors";
    let lastColorGroups = [];
    let lastTypographyGroups = [];
    let appliedTokens = [];
    let isSelectAllMode = false;
    let isLoadingTokens = false;

    let loadingTimeout = null;

    // üî• Rastreia tokens aplicados por nodeId
    let appliedTokensByNode = new Map(); // Map<nodeId, { styleName, styleId, hex? }>

    // üî• Rastreia o √∫ltimo token aplicado (para mostrar o check)
    let lastAppliedStyleId = null;

    function applyTypographyToken(tokenId, nodeIds) {
      parent.postMessage(
        {
          pluginMessage: {
            type: "apply-typography-token",
            styleId: tokenId,
            nodeIds: nodeIds
          }
        },
        "*"
      );
    }


    function selectNodes(nodeIds) {
      parent.postMessage(
        {
          pluginMessage: {
            type: "select-multiple-nodes",
            nodeIds: nodeIds
          }
        },
        "*"
      );
    }

    // üî• CORRIGIDO: Agora passa isStroke corretamente
    function applyTokenToNodes(tokenId, nodeIds, isStroke) {
      parent.postMessage(
        {
          pluginMessage: {
            type: "apply-token-multiple",
            styleId: tokenId,
            nodeIds: nodeIds,
            isStroke: isStroke
          }
        },
        "*"
      );
    }


    // Fun√ß√µes para controlar o loading
    function showLoading() {
      console.log("Mostrando spinner");
      app.innerHTML = "";
      topBarContainer.innerHTML = "";

      // Aguarda 300ms antes de realmente mostrar o spinner
      loadingTimeout = setTimeout(() => {
        spinner.classList.add("show");
      }, 300);
    }

    function hideLoading() {
      console.log("Escondendo spinner");

      // Limpa o timeout se o carregamento terminar antes de 300ms
      if (loadingTimeout) {
        clearTimeout(loadingTimeout);
        loadingTimeout = null;
      }

      spinner.classList.remove("show");
    }

    function switchTab(tab) {
      currentTab = tab;

      // Atualiza visual das tabs
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      const tabs = document.querySelectorAll(".tab");
      if (tab === "colors") {
        tabs[0].classList.add("active");
      } else {
        tabs[1].classList.add("active");
      }

      // Reseta view
      viewMode = "list";
      currentGroup = null;
      appliedTokens = [];

      // Mostra loading
      showLoading();

      // Notifica o plugin
      parent.postMessage({ pluginMessage: { type: "switch-tab", tab } }, "*");
    }

    function renderTopBar(show) {
      topBarContainer.innerHTML = "";
      // N√£o mostra top bar se n√£o deve mostrar ou n√£o est√° em modo lista
      if (!show || viewMode !== "list") return;

      const div = document.createElement("div");
      div.className = "top-bar";
      div.innerHTML = `
    <div class="switch-container">
      <label class="switch">
        <input type="checkbox" ${showHidden ? "checked" : ""}/>
        <span class="slider"></span>
      </label>
      <span class="switch-label">Exibir elementos ocultos</span>
    </div>
  `;

      div.querySelector("input").addEventListener("change", e => {
        showHidden = e.target.checked;
        // Mostra loading imediatamente
        showLoading();
        parent.postMessage({ pluginMessage: { type: "toggle-hidden", value: showHidden } }, "*");
      });

      topBarContainer.appendChild(div);
    }

    function paintToCss(paint, node) {
      if (!paint) return "#000";

      if (paint.type === "SOLID") {
        const r = Math.round(paint.color.r * 255);
        const g = Math.round(paint.color.g * 255);
        const b = Math.round(paint.color.b * 255);
        let a = paint.opacity ?? 1;
        if (node?.opacity) a *= node.opacity;
        return `rgba(${r},${g},${b},${a})`;
      }

      if (paint.type.startsWith("GRADIENT")) {
        const stops = paint.gradientStops.map(s => {
          const r = Math.round(s.color.r * 255);
          const g = Math.round(s.color.g * 255);
          const b = Math.round(s.color.b * 255);
          return `rgba(${r},${g},${b},${s.color.a}) ${s.position * 100}%`;
        }).join(", ");
        return `linear-gradient(90deg, ${stops})`;
      }

      return "#000";
    }

    // Converte o estilo do Figma (ex: "Bold Italic") para propriedades CSS
    function parseFigmaFontStyle(fontStyle, fontWeight) {
      let cssWeight = typeof fontWeight === "number" ? fontWeight : 400;
      let cssStyle = "normal";

      const styleLower = fontStyle.toLowerCase();

      // Detecta italic/oblique
      if (styleLower.includes("italic") || styleLower.includes("oblique")) {
        cssStyle = "italic";
      }

      // Mapeia estilos comuns para pesos
      if (styleLower.includes("thin")) cssWeight = 100;
      else if (styleLower.includes("extralight") || styleLower.includes("extra light")) cssWeight = 200;
      else if (styleLower.includes("light")) cssWeight = 300;
      else if (styleLower.includes("regular") || styleLower.includes("normal")) cssWeight = 400;
      else if (styleLower.includes("medium")) cssWeight = 500;
      else if (styleLower.includes("semibold") || styleLower.includes("semi bold")) cssWeight = 600;
      else if (styleLower.includes("bold")) cssWeight = 700;
      else if (styleLower.includes("extrabold") || styleLower.includes("extra bold")) cssWeight = 800;
      else if (styleLower.includes("black") || styleLower.includes("heavy")) cssWeight = 900;

      return { weight: cssWeight, style: cssStyle };
    }

    function selectCurrentNode() {
      if (!currentGroup) return;
      const entry = currentTab === "colors"
        ? currentGroup.nodePaints[currentIndex]
        : currentGroup.nodeStyles[currentIndex];
      parent.postMessage({
        pluginMessage: { type: "select-node", nodeId: entry.nodeId }
      }, "*");
    }

    function toggleSelectAll(checked) {
      isSelectAllMode = checked;

      const items =
        currentTab === "colors"
          ? currentGroup.nodePaints
          : currentGroup.nodeStyles;

      const nodeIds = items.map(n => n.nodeId);

      if (checked) {
        // Apenas seleciona os n√≥s
        selectNodes(nodeIds);
      } else {
        // Volta para navega√ß√£o individual
        currentIndex = 0;
        selectCurrentNode();
      }

      if (currentTab === "colors") {
        renderColorDetail();
      } else {
        renderTypographyDetail();
      }
    }





    onmessage = e => {
      const msg = e.data.pluginMessage;
      console.log("Mensagem recebida:", msg.type);

      // Token aplicado com sucesso
      if (msg.type === "token-applied-success") {
        console.log("Token aplicado com sucesso!", msg);

        document.querySelectorAll('.token-item.applying').forEach(el => {
          el.classList.remove('applying');
        });

        // üî• Salva o √∫ltimo token aplicado
        lastAppliedStyleId = msg.styleId;

        // üî• Salva os tokens aplicados por nodeId
        const items = currentTab === "colors" ? currentGroup.nodePaints : currentGroup.nodeStyles;

        if (isSelectAllMode) {
          // Aplica para todos os nodes
          items.forEach(item => {
            const tokenData = {
              styleName: msg.styleName,
              styleId: msg.styleId
            };

            if (currentTab === "colors") {
              const token = appliedTokens.find(t => t.styleId === msg.styleId);
              if (token && token.hex) {
                tokenData.hex = token.hex;
              }
            } else {
              // üî• Para tipografia, salva tamb√©m fontStyle e fontSize
              const token = appliedTokens.find(t => t.styleId === msg.styleId);
              if (token) {
                tokenData.fontStyle = token.fontStyle;
                tokenData.fontSize = token.fontSize;
              }
            }

            appliedTokensByNode.set(item.nodeId, tokenData);
          });
        } else {
          // Aplica apenas para o node atual
          const currentItem = items[currentIndex];
          const tokenData = {
            styleName: msg.styleName,
            styleId: msg.styleId
          };

          if (currentTab === "colors") {
            const token = appliedTokens.find(t => t.styleId === msg.styleId);
            if (token && token.hex) {
              tokenData.hex = token.hex;
            }
          } else {
            // üî• Para tipografia, salva tamb√©m fontStyle e fontSize
            const token = appliedTokens.find(t => t.styleId === msg.styleId);
            if (token) {
              tokenData.fontStyle = token.fontStyle;
              tokenData.fontSize = token.fontSize;
            }
          }

          appliedTokensByNode.set(currentItem.nodeId, tokenData);
        }

        // üî• Atualiza os detalhes na tela (hex ou nome da fonte)
        if (viewMode === "detail") {
          const hexCodeEl = document.getElementById('hex-code');
          if (hexCodeEl && msg.styleName) {
            hexCodeEl.textContent = msg.styleName;
          }

          // Se for cor, atualiza tamb√©m o swatch
          if (currentTab === "colors" && msg.styleId) {
            const detailSwatch = document.querySelector('.detail-swatch-large');
            if (detailSwatch) {
              // Busca a cor do token aplicado
              const appliedToken = appliedTokens.find(t => t.styleId === msg.styleId);
              if (appliedToken && appliedToken.hex) {
                detailSwatch.style.backgroundColor = appliedToken.hex;
              }
            }
          }

          // üî• Re-renderiza para mostrar o check e atualizar descri√ß√£o
          if (currentTab === "colors") {
            renderColorDetail();
          } else {
            renderTypographyDetail();
          }
        }
      }

      // üî• NOVO: Token removido com sucesso
      if (msg.type === "token-removed-success") {
        console.log("Token removido com sucesso!", msg);

        // üî• Remove o √∫ltimo token aplicado
        lastAppliedStyleId = null;

        // üî• Remove dos tokens aplicados por nodeId
        const items = currentTab === "colors" ? currentGroup.nodePaints : currentGroup.nodeStyles;

        if (isSelectAllMode) {
          items.forEach(item => {
            appliedTokensByNode.delete(item.nodeId);
          });
        } else {
          const currentItem = items[currentIndex];
          appliedTokensByNode.delete(currentItem.nodeId);
        }

        // üî• Atualiza os detalhes na tela - volta para valor original
        if (viewMode === "detail") {
          const hexCodeEl = document.getElementById('hex-code');

          if (currentTab === "colors") {
            const entry = currentGroup.nodePaints[currentIndex];
            const bg = paintToCss(entry.paint, entry.node);

            if (hexCodeEl) {
              hexCodeEl.textContent = currentGroup.label;
            }

            const detailSwatch = document.querySelector('.detail-swatch-large');
            if (detailSwatch) {
              detailSwatch.style.backgroundColor = bg;
            }

            renderColorDetail();
          } else {
            const entry = currentGroup.nodeStyles[currentIndex];
            const style = entry.style;

            if (hexCodeEl) {
              hexCodeEl.textContent = style.fontFamily;
            }

            renderTypographyDetail();
          }
        }
      }



      // Erro ao aplicar token
      if (msg.type === "token-applied-error") {
        console.error("Erro ao aplicar token:", msg.message || "Erro desconhecido");

        // Remove a classe "applying" de todos os itens
        document.querySelectorAll('.token-item.applying').forEach(el => {
          el.classList.remove('applying');
        });

        // Mostra mensagem de erro ao usu√°rio se houver
        if (msg.message) {
          alert(msg.message);
        }

        return;
      }

      // Se clearAll for true, limpa TUDO e mostra empty
      if (msg.clearAll) {
        lastColorGroups = [];
        lastTypographyGroups = [];
        appliedTokens = [];
        renderEmpty();
        hideLoading();
        return;
      }

      if (msg.type === "empty") {
        renderEmpty();
        hideLoading();
      }

      if (msg.type === "result-colors") {
        lastColorGroups = msg.groups;
        renderColorList(msg.groups);
        // Garante que o loading seja escondido ap√≥s a renderiza√ß√£o
        setTimeout(() => hideLoading(), 0);
      }

      if (msg.type === "result-suggested-tokens") {
        appliedTokens = msg.tokens || [];
        isLoadingTokens = false;
        console.log("Tokens recebidos:", appliedTokens.length);
        renderColorDetail();
        if (!isSelectAllMode) {
          selectCurrentNode();
        }
      }

      if (msg.type === "result-suggested-text-tokens") {
        appliedTokens = msg.tokens || [];
        isLoadingTokens = false;
        console.log("Tokens de texto recebidos:", appliedTokens.length);
        renderTypographyDetail();
        if (!isSelectAllMode) {
          selectCurrentNode();
        }
      }

      if (msg.type === "result-typography") {
        lastTypographyGroups = msg.groups;
        renderTypographyList(msg.groups);
        // Garante que o loading seja escondido ap√≥s a renderiza√ß√£o
        setTimeout(() => hideLoading(), 0);
      }

      if (msg.type === "init-tab") {
        currentTab = msg.tab;
      }
    };

    function renderEmpty() {
      viewMode = "list";
      renderTopBar(false);
      app.innerHTML = `<div class="empty">Selecione um ou mais frames</div>`;
    }

    function renderColorList(groups) {
      viewMode = "list";
      renderTopBar(true);

      if (!groups.length) {
        app.innerHTML = `
    <div class="app-wrapper">
      <h4>Elementos sem token aplicado:</h4>
      <div class="empty-2">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAARtSURBVHgBzVlNbBtFFP5mvIbiKMHQH3GoXa9aIyKQ6oIEF1BdDnDpJVyoxIUiIU4QlxM5VElUCTiBI04IIcIBiV7IIb20l7iCS5FARoqUSiSyGyMh2kBNGrutvbvT98ZZN3Fde9Z1fj7J2p+Z2fnyvTfvzbwI9Ig/S/W0BXnUhUhDICWUiiogym0CKHsQRbrST+U9eJeTsXAOPUAE6VwoqKhjeRkJjPpkjCdSKNIlJ93apG0/UTQeZ9KJibmWN0G3o+gDiOy0KdGuBJf+cjNQGA+qWNeJSVEp1YR90Pq+Y79OjYslN4s+qfZQAgrZw/HQmYe2t3vZMKmaAVQa2wAFkV9zxIljtii3tsl2A4jc3HaRY9BKTw1qQR7EAwQbZlUpbDtUemnZ/bL17SYTLy4770KI77CDUB7OJA+Fsv5zk2Dhb5XwXDWnlEpgZ1G+5Ujb98emiT3XG98F5BjRoZA37j9oBVk91/EK6AOu33Bw9rN/9f177zyJV17ag15AKj7FKmoFWT30CfNXa6hUFU68GsHnU//p+14wZHk6/q6bmBJ+n1CpejiwL4RTbw3q65XfbqMX0J+V4avkXUm/fI/Ne+FiBS8MP94kOxCR6BFRvWOSkMd7M8JmzF5cw/mZW6SahbdHBjG/cFeb1z4URq8gbkctMm9KC/oI+PGnVVy4VMGpkSGcfHMAhWs1TZhNzEQZrKQdt3Bgv2X8XUqBaYuoJRAAbMZZIlNcriMRC+vPzP1yG+fG9jXVmr1UpXYXHCTOz6zpd5Vq4/nc2F5zVZVKiaWSezPIVuqDj//RKuzfKzWxgYjAJ6NPN/2uE3hVR0jJj943nq4sg5Bjc11fcfHh+gRM6usvnjEix0jEw7ix4iIAooGW2JXf72gy7Fu/0v3JNwa0glsJyQcc087sfzapwIuAV6ipcj54HI8PADKxEMYEmVSEFPOzQ1D1issOmTnIKqZjAW2586YDmFCVyPnEgqQx33+DqC7o6ColVM50AK9ensSPZZzG5q/e1RmjG7794X+8/lpE+685QZW3HHh/CJitFfafuZ9XUal4eP65x/DVN/e94+UX9+idC/9a0xsHcl69Y5lBBAFlkpy2lWksZKXOfrqCAvkSg83FMbBwrU4xsdo0YztwaGIFjUHH0iPxkO0T5HPvhOnY+YWavnJGaF0ofttGtOtnQHCaCJ5ubFgblYOb2EWoOzV7mCoP2lls2rnyARq7BaTe8HpZpOnN0pWTQYL2loF8r051G/+xSZBV9AQmsdOges3whqLSpniQPBjK7qSpFc19pKWY1HZpLZa8bS19MLg+k4zJY63v20bokCNGiLtxCnx0qBwXj9q1dAxOXCtRonG62iqwWZMdym8dcxzX7TylTlO9poj+o0zqZDqRY3RNws/Grel6iOQXmEafwKpx/eVwLDTVrW+g/LNAJZKwrkLQQT/4WZoVy646cqpdoRL9ILgRhZI6Tv9eSPOxVUGT5Z+/4SjTlyk78UJTOdqV5O2YuIwecA/A0uHIhF2qXAAAAABJRU5ErkJggg==" alt="Ilustra√ß√£o"/>


        Tudo certo por aqui!
      </div>
    </div>
    `;
        return;
      }

      app.innerHTML = `
  <h4>Elementos sem token aplicado:</h4>
  <div class="app-wrapper-2">
    ${groups.map(g => {
        const np = g.nodePaints[0];
        const swatch = paintToCss(np.paint, np.node);

        const typeLabel =
          g.nodePaints.every(n => n.isStroke) ? "Stroke" :
            g.nodePaints.every(n => !n.isStroke) ? "Fill" : "Mix";

        return `
        <div class="group" onclick='openDetail(${JSON.stringify(g)})'>
          <div class="swatch-large" style="background:${swatch}" data-token-color="${swatch}"></div>

          <div class="group-info">
            <div class="group-info-top">
              <strong class="hex" data-token-color="${swatch}">${g.label}</strong>
              <span class="type-label">(${typeLabel.toLowerCase()})</span>
            </div>

            <div class="group-info-bottom">
              ${g.nodePaints.length} ${g.nodePaints.length === 1 ? "elemento" : "elementos"}
            </div>
          </div>
        </div>
      `;
      }).join("")}
  </div>
`;




    }

    function renderTypographyList(groups) {
      viewMode = "list";
      renderTopBar(true);

      if (!groups.length) {
        app.innerHTML = `
    <div class="app-wrapper">
      <h4>Textos sem estilos aplicados:</h4>
      <div class="empty-2">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAARtSURBVHgBzVlNbBtFFP5mvIbiKMHQH3GoXa9aIyKQ6oIEF1BdDnDpJVyoxIUiIU4QlxM5VElUCTiBI04IIcIBiV7IIb20l7iCS5FARoqUSiSyGyMh2kBNGrutvbvT98ZZN3Fde9Z1fj7J2p+Z2fnyvTfvzbwI9Ig/S/W0BXnUhUhDICWUiiogym0CKHsQRbrST+U9eJeTsXAOPUAE6VwoqKhjeRkJjPpkjCdSKNIlJ93apG0/UTQeZ9KJibmWN0G3o+gDiOy0KdGuBJf+cjNQGA+qWNeJSVEp1YR90Pq+Y79OjYslN4s+qfZQAgrZw/HQmYe2t3vZMKmaAVQa2wAFkV9zxIljtii3tsl2A4jc3HaRY9BKTw1qQR7EAwQbZlUpbDtUemnZ/bL17SYTLy4770KI77CDUB7OJA+Fsv5zk2Dhb5XwXDWnlEpgZ1G+5Ujb98emiT3XG98F5BjRoZA37j9oBVk91/EK6AOu33Bw9rN/9f177zyJV17ag15AKj7FKmoFWT30CfNXa6hUFU68GsHnU//p+14wZHk6/q6bmBJ+n1CpejiwL4RTbw3q65XfbqMX0J+V4avkXUm/fI/Ne+FiBS8MP94kOxCR6BFRvWOSkMd7M8JmzF5cw/mZW6SahbdHBjG/cFeb1z4URq8gbkctMm9KC/oI+PGnVVy4VMGpkSGcfHMAhWs1TZhNzEQZrKQdt3Bgv2X8XUqBaYuoJRAAbMZZIlNcriMRC+vPzP1yG+fG9jXVmr1UpXYXHCTOz6zpd5Vq4/nc2F5zVZVKiaWSezPIVuqDj//RKuzfKzWxgYjAJ6NPN/2uE3hVR0jJj943nq4sg5Bjc11fcfHh+gRM6usvnjEix0jEw7ix4iIAooGW2JXf72gy7Fu/0v3JNwa0glsJyQcc087sfzapwIuAV6ipcj54HI8PADKxEMYEmVSEFPOzQ1D1issOmTnIKqZjAW2586YDmFCVyPnEgqQx33+DqC7o6ColVM50AK9ensSPZZzG5q/e1RmjG7794X+8/lpE+685QZW3HHh/CJitFfafuZ9XUal4eP65x/DVN/e94+UX9+idC/9a0xsHcl69Y5lBBAFlkpy2lWksZKXOfrqCAvkSg83FMbBwrU4xsdo0YztwaGIFjUHH0iPxkO0T5HPvhOnY+YWavnJGaF0ofttGtOtnQHCaCJ5ubFgblYOb2EWoOzV7mCoP2lls2rnyARq7BaTe8HpZpOnN0pWTQYL2loF8r051G/+xSZBV9AQmsdOges3whqLSpniQPBjK7qSpFc19pKWY1HZpLZa8bS19MLg+k4zJY63v20bokCNGiLtxCnx0qBwXj9q1dAxOXCtRonG62iqwWZMdym8dcxzX7TylTlO9poj+o0zqZDqRY3RNws/Grel6iOQXmEafwKpx/eVwLDTVrW+g/LNAJZKwrkLQQT/4WZoVy646cqpdoRL9ILgRhZI6Tv9eSPOxVUGT5Z+/4SjTlyk78UJTOdqV5O2YuIwecA/A0uHIhF2qXAAAAABJRU5ErkJggg==" alt="Ilustra√ß√£o"/>


        Tudo certo por aqui!
      </div>
    </div>
    `;
        return;
      }

      app.innerHTML = `
  <h4>Textos sem estilos aplicados:</h4>
  <div class="app-wrapper-2">
    ${groups.map(g => {
        const style = g.style;
        const fontWeight = typeof style.fontWeight === "number" ? style.fontWeight : 400;
        const cssFont = parseFigmaFontStyle(style.fontStyle, fontWeight);

        return `
        <div class="group" onclick='openTypographyDetail(${JSON.stringify(g)})'>
          <!-- Quadrado de preview da fonte -->
          <div class="swatch-large" style="
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: '${style.fontFamily}', sans-serif;
            font-weight: ${cssFont.weight};
            font-style: ${cssFont.style};
            font-size: 20px;
            color: #18181B;
            background-color: white;
          ">
            Ag
          </div>

          <!-- Informa√ß√µes da fonte -->
          <div class="group-info">
            <div class="group-info-top">
              <strong class="hex">${style.fontFamily} ${cssFont.weight}</strong>
            </div>

            <div class="group-info-bottom">
              ${g.nodeStyles.length} ${g.nodeStyles.length === 1 ? "elemento" : "elementos"}
            </div>

          </div>
        </div>
      `;
      }).join("")}
  </div>
`;

    }

    function openDetail(group) {
      // üî• Salva a sele√ß√£o inicial quando abre os detalhes
      parent.postMessage({ pluginMessage: { type: "save-initial-selection" } }, "*");

      // üî• Salva o estado original dos nodes antes de aplicar tokens
      parent.postMessage({ pluginMessage: { type: "save-original-state", nodeIds: group.nodePaints.map(np => np.nodeId) } }, "*");

      currentGroup = group;
      currentIndex = 0;
      isSelectAllMode = false;
      isLoadingTokens = true;
      viewMode = "detail";
      topBarContainer.innerHTML = "";
      appliedTokens = [];

      // üî• Verifica se o primeiro elemento tem um token aplicado
      const firstItem = group.nodePaints[0];
      const appliedToken = appliedTokensByNode.get(firstItem.nodeId);
      lastAppliedStyleId = appliedToken ? appliedToken.styleId : null;

      // Renderiza a tela com loading de tokens
      renderColorDetail();

      // Solicita tokens ao backend
      parent.postMessage({ pluginMessage: { type: "get-suggested-tokens" } }, "*");
    }

    function openTypographyDetail(group) {
      // üî• Salva a sele√ß√£o inicial quando abre os detalhes
      parent.postMessage({ pluginMessage: { type: "save-initial-selection" } }, "*");

      // üî• Salva o estado original dos nodes antes de aplicar tokens
      parent.postMessage({ pluginMessage: { type: "save-original-state", nodeIds: group.nodeStyles.map(ns => ns.nodeId) } }, "*");

      currentGroup = group;
      currentIndex = 0;
      isSelectAllMode = false;
      isLoadingTokens = true;
      viewMode = "detail";
      topBarContainer.innerHTML = "";
      appliedTokens = [];

      // üî• Verifica se o primeiro elemento tem um token aplicado
      const firstItem = group.nodeStyles[0];
      const appliedToken = appliedTokensByNode.get(firstItem.nodeId);
      lastAppliedStyleId = appliedToken ? appliedToken.styleId : null;

      // Renderiza a tela com loading de tokens
      renderTypographyDetail();

      // Solicita tokens ao backend
      parent.postMessage({ pluginMessage: { type: "get-suggested-tokens" } }, "*");

      // Seleciona o n√≥ atual
      selectCurrentNode();
    }

    function renderColorDetail() {
      const entry = currentGroup.nodePaints[currentIndex];
      const bg = paintToCss(entry.paint, entry.node);
      const isStroke = entry.isStroke; // üî• Salva isStroke em vari√°vel

      // üî• Verifica se este node j√° tem um token aplicado
      const appliedTokenData = appliedTokensByNode.get(entry.nodeId);
      const displayLabel = appliedTokenData ? appliedTokenData.styleName : currentGroup.label;
      const displayBg = appliedTokenData && appliedTokenData.hex ? appliedTokenData.hex : bg;

      app.innerHTML = `
    <div class="detail-color-wrapper">
      <div class="detail-color-container">
        <div class="detail-left">
          <h4>Cor:</h4>
          <div class="container">
            <div class="detail-swatch-large" style="background:${displayBg}"></div>  
          
            <div class="detail-info">
              <div id="hex-code">${displayLabel}</div>
              <div class="type-label">(${entry.isStroke ? "stroke" : "fill"})</div>
            </div>
            
            <div class="detail-nav">
              <button
                onclick="prev()"
                ${currentGroup.nodePaints.length <= 1 || isSelectAllMode ? "disabled" : ""}
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor" class="nav-icon">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.75 19.5 8.25 12l7.5-7.5" />
                </svg>
              </button>

              <span class="nav-counter">
                ${isSelectAllMode
          ? `${currentGroup.nodePaints.length} de ${currentGroup.nodePaints.length}`
          : `${currentIndex + 1} de ${currentGroup.nodePaints.length}`
        }
              </span>

              <button
                onclick="next()"
                ${currentGroup.nodePaints.length <= 1 || isSelectAllMode ? "disabled" : ""}
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor" class="nav-icon">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                </svg>
              </button>
            </div>
              
            ${currentGroup.nodePaints.length > 1
          ? `<label class="select-all-checkbox">
                <input type="checkbox" ${isSelectAllMode ? "checked" : ""} onchange="toggleSelectAll(this.checked)">
                <span>Selec. todos</span>
              </label>`
          : ""}
          </div>
        </div>

        <div class="detail-right">
          <h4>Tokens sugeridos:</h4>
          <div class="tokens-container">
            ${isLoadingTokens
          ? `<div class="tokens-loading">
                  <div class="spinner"></div>
                  <div class="spinner-text">Buscando tokens...</div>
                </div>`
          : (appliedTokens.length > 0
            ? `<div class="tokens-list">
                    ${appliedTokens.map((token, idx) => {
              const safeName = (token.name || '').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
              return `
                      <div class="token-item" onclick="applyToken('${token.styleId || ''}', ${isStroke})" title="${safeName}">
                        <div class="token-swatch" style="background:${token.hex}"></div>
                        <div style="flex: 1; min-width: 0;">
                          <div class="token-name">${token.name}</div>
                        </div>
                        ${lastAppliedStyleId === token.styleId ? `
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="token-check-icon">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                          </svg>
                        ` : ''}
                      </div>
                    `}).join("")}
                  </div>`
            : `<div class="empty-state-tokens">
                    Sem tokens de cor para sugerir.
                  </div>`
          )
        }
          </div>
        </div>
      </div>

      <div class="detail-footer">
        <button class="back-button" onclick="back()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
          </svg> 
          Voltar para a lista
        </button>
      </div>
    </div>
  `;
    }

    function renderTypographyDetail() {
      const entry = currentGroup.nodeStyles[currentIndex];
      const style = entry.style;

      // üî• Verifica se este node j√° tem um token aplicado
      const appliedTokenData = appliedTokensByNode.get(entry.nodeId);

      // üî• Usa dados do token aplicado se existir, sen√£o usa do estilo original
      const displayLabel = appliedTokenData ? appliedTokenData.styleName : style.fontFamily;
      const displayFontStyle = appliedTokenData && appliedTokenData.fontStyle ? appliedTokenData.fontStyle : style.fontStyle;
      const displayFontSize = appliedTokenData && appliedTokenData.fontSize
        ? `${appliedTokenData.fontSize}px`
        : (typeof style.fontSize === "number" ? `${style.fontSize}px` : style.fontSize);

      const fontWeight = typeof style.fontWeight === "number" ? style.fontWeight : 400;
      const cssFont = parseFigmaFontStyle(style.fontStyle, fontWeight);

      app.innerHTML = `
    <div class="detail-color-wrapper">
      <div class="detail-color-container">

        <!-- ESQUERDA (igual cor) -->
        <div class="detail-left">
          <h4>Fonte:</h4>

          <div class="container">
            <div
              class="detail-swatch-large"
              style="
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: '${style.fontFamily}', sans-serif;
                font-size: 28px;
                font-weight: ${cssFont.weight};
                font-style: ${cssFont.style};
                background: white;
                color: #18181B;
              "
            >
              Ag
            </div>

            <div class="detail-info">
              <div id="hex-code">${displayLabel}</div>
              <div class="type-label">
                ${displayFontStyle} ${displayFontSize}
              </div>
            </div>

            <div class="detail-nav">
              <button
                onclick="prev()"
                ${currentGroup.nodeStyles.length <= 1 || isSelectAllMode ? "disabled" : ""}
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor" class="nav-icon">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.75 19.5 8.25 12l7.5-7.5" />
                </svg>
              </button>

              <span class="nav-counter">
                ${isSelectAllMode
          ? `${currentGroup.nodeStyles.length} de ${currentGroup.nodeStyles.length}`
          : `${currentIndex + 1} de ${currentGroup.nodeStyles.length}`
        }
              </span>

              <button
                onclick="next()"
                ${currentGroup.nodeStyles.length <= 1 || isSelectAllMode ? "disabled" : ""}
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor" class="nav-icon">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                </svg>
              </button>
            </div>

            ${currentGroup.nodeStyles.length > 1
          ? `<label class="select-all-checkbox">
                    <input type="checkbox" ${isSelectAllMode ? "checked" : ""} onchange="toggleSelectAll(this.checked)">
                    <span>Selec. todos</span>
                  </label>`
          : ""
        }
          </div>
        </div>

        <!-- DIREITA (infos da fonte) -->
        <div class="detail-right">
          <h4>Estilos sugeridos:</h4>

          <div class="tokens-container">
            ${isLoadingTokens
          ? `<div class="tokens-loading">
                  <div class="spinner"></div>
                  <div class="spinner-text">Buscando estilos...</div>
                </div>`
          : (appliedTokens.length > 0
            ? `<div class="tokens-list">
                    ${appliedTokens.map(token => {
              const safeName = (token.name || '').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
              return `
                      <div
                        class="token-item"
                        style="display: flex; flex-direction: row;"
                        onclick="applyToken('${token.styleId || ''}', false)"
                        title="${safeName}"
                      >
                        <div style="flex: 1; min-width: 0;">
                          <div class="token-name">${token.name}</div>
                          ${token.fontSize ? `<div class="token-info-small">
                            ${token.fontStyle || ''} ${token.fontSize}px
                          </div>` : ''}
                        </div>
                        ${lastAppliedStyleId === token.styleId ? `
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="token-check-icon">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                          </svg>
                        ` : ''}
                      </div>
                    `}).join("")}
                  </div>`
            : `<div class="empty-state-tokens">
                    Sem estilos de fonte para sugerir.
                  </div>`
          )
        }
          </div>
        </div>

      </div>

      <div class="detail-footer">
        <button class="back-button" onclick="back()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
          </svg>
          Voltar para a lista
        </button>
      </div>
    </div>
  `;
    }


    function next() {
      if (isSelectAllMode) {
        return;
      }

      const items =
        currentTab === "colors"
          ? currentGroup.nodePaints
          : currentGroup.nodeStyles;

      currentIndex = (currentIndex + 1) % items.length;

      // üî• Verifica se o pr√≥ximo elemento tem um token aplicado
      const nextItem = items[currentIndex];
      const appliedToken = appliedTokensByNode.get(nextItem.nodeId);
      lastAppliedStyleId = appliedToken ? appliedToken.styleId : null;

      if (currentTab === "colors") {
        renderColorDetail();
      } else {
        renderTypographyDetail();
      }

      selectCurrentNode();
    }


    function prev() {
      if (isSelectAllMode) {
        return;
      }

      const items =
        currentTab === "colors"
          ? currentGroup.nodePaints
          : currentGroup.nodeStyles;

      currentIndex = (currentIndex - 1 + items.length) % items.length;

      // üî• Verifica se o elemento anterior tem um token aplicado
      const prevItem = items[currentIndex];
      const appliedToken = appliedTokensByNode.get(prevItem.nodeId);
      lastAppliedStyleId = appliedToken ? appliedToken.styleId : null;

      if (currentTab === "colors") {
        renderColorDetail();
      } else {
        renderTypographyDetail();
      }

      selectCurrentNode();
    }


    // üî• CORRIGIDO: Agora aceita isStroke como par√¢metro
    function applyToken(styleId, isStroke = false) {
      console.log("üîµ applyToken chamado:", { styleId, isStroke, currentTab });

      const items =
        currentTab === "colors"
          ? currentGroup.nodePaints
          : currentGroup.nodeStyles;

      let nodeIds;

      if (isSelectAllMode) {
        // Aplica em todos
        nodeIds = items.map(n => n.nodeId);
      } else {
        // Aplica s√≥ no atual
        nodeIds = [items[currentIndex].nodeId];
      }

      console.log("üîµ nodeIds:", nodeIds);

      // üî• NOVO: Verifica se est√° clicando no token j√° aplicado para desaplicar
      if (lastAppliedStyleId === styleId) {
        console.log("üîµ Desaplicando token...");
        // Remove o token aplicado
        if (currentTab === "colors") {
          removeColorToken(nodeIds, isStroke);
        } else {
          removeTextToken(nodeIds);
        }
        return;
      }

      if (currentTab === "colors") {
        // Para cores, usa apply-token-multiple com isStroke
        console.log("üîµ Aplicando cor...");
        applyTokenToNodes(styleId, nodeIds, isStroke);
      } else {
        // Para tipografia, usa apply-typography-token-multiple
        console.log("üîµ Aplicando tipografia...", { type: "apply-typography-token-multiple", styleId, nodeIds });
        parent.postMessage({
          pluginMessage: {
            type: "apply-typography-token-multiple",
            styleId,
            nodeIds
          }
        }, "*");
      }
    }

    // üî• NOVA FUN√á√ÉO: Remove token de cor
    function removeColorToken(nodeIds, isStroke) {
      parent.postMessage({
        pluginMessage: {
          type: "remove-color-token",
          nodeIds,
          isStroke
        }
      }, "*");
    }

    // üî• NOVA FUN√á√ÉO: Remove token de texto
    function removeTextToken(nodeIds) {
      parent.postMessage({
        pluginMessage: {
          type: "remove-text-token",
          nodeIds
        }
      }, "*");
    }


    function back() {
      viewMode = "list";
      isSelectAllMode = false;
      appliedTokens = [];
      isLoadingTokens = false;
      appliedTokensByNode.clear(); // üî• Limpa os tokens aplicados
      hideLoading();
      renderTopBar(true);

      // üî• Notifica o backend que voltou para list view
      parent.postMessage({ pluginMessage: { type: "back-to-list" } }, "*");

      if (currentTab === "colors") {
        renderColorList(lastColorGroups);
      } else {
        renderTypographyList(lastTypographyGroups);
      }
    }
  </script>
</body>

</html>